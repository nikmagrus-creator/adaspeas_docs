# ROADMAP (RU): приоритеты разработки

Актуально на: 2026-02-06 12:45 MSK

Этот документ фиксирует порядок работ. Детали требований см. `docs/PRD_RU.md`, целевую архитектуру — `docs/TECH_SPEC_RU.md`.


## Milestone 1 — Фундамент и UX каталога (приоритет №1)

Цель: бот должен выглядеть как продукт и уметь выдавать файлы “библиотечного” размера.

1) **Inline‑навигация каталога** *(planned)*
- папки и файлы через inline‑кнопки
- редактирование одного сообщения
- кнопка “Назад”
- (опционально) страницы/поиск

2) **Local Bot API Server (режим `--local`)** *(done, infra+код)*
- docker‑сервис `local-bot-api` (Compose profile `localbotapi`)
- переключатель в `.env`: `USE_LOCAL_BOT_API=1` + `LOCAL_BOT_API_BASE`
- на прод‑деплое профиль поднимается автоматически, если флаг включён
- TODO: e2e тест на файл > 50 MB

3) **Фоновая синхронизация каталога** *(planned)*
- UI читает только SQLite
- синхронизация отдельной задачей в worker (план: расписание + ручной триггер для админа)
- метка “обновлено …” (last sync) в UI

4) **Кэширование Telegram `file_id`** *(done, worker)*
- `tg_file_id`/`tg_file_unique_id` в `catalog_items`
- повторная отправка без скачивания с Диска (fast‑path)

Выходной критерий M1:
- активный пользователь кликает папки/файлы и получает файл в 2–3 клика, включая файлы > 50 MB (через Local Bot API).


## Milestone 2 — Контроль доступа (приоритет №2)

Цель: ограниченный доступ без инвайт‑кодов, управляемый админами.

- FSM/статусы пользователей: guest → pending → active → expired/blocked
- профиль/поле идентификации от пользователя (`user_note`)
- админ‑экран: список пользователей, срок, продление, блокировка
- предупреждение за 24 часа пользователю и админам (как минимум: каждому из `ADMIN_USER_IDS`)
- (опционально) отдельный `ADMIN_CHAT_ID` под уведомления


## Milestone 3 — Эксплуатация и прозрачность (приоритет №3)

Цель: чтобы админ понимал, что происходит, и система не “умирала тихо”.

- аудит скачиваний (кто/что/когда/результат)
- статистика для админа (минимум: топ файлов, активные пользователи)
- нормальные сообщения об ошибках + уведомления админам
- бэкапы SQLite (+ volume local-bot-api)


## Backlog идей (IDEA-###)

| ID | Кратко | Статус | Где фиксируем | Примечание |
|---|---|---|---|---|
| IDEA-001 | Inline‑навигация каталога | planned | Milestone 1 | UX ядро |
| IDEA-002 | Фоновая синхронизация каталога | planned | Milestone 1 | SQLite как кэш |
| IDEA-003 | Поиск/пагинация в каталоге | idea | Backlog | После inline |
| IDEA-004 | Backoff/ретраи для Telegram/Yandex | idea | Backlog | Для устойчивости |
| IDEA-005 | Авто‑включение `localbotapi` на прод‑деплое | done | deploy.yml | По флагу USE_LOCAL_BOT_API |
| IDEA-006 | CI guard: изменения кода требуют CHANGELOG/CHATLOG | done | deploy.yml | Чтобы не “забывать” след |


## История изменений
| Дата/время (MSK) | Автор | Тип | Кратко | Commit/PR |
|---|---|---|---|---|
| 2026-02-06 00:10 MSK | ChatGPT | doc | Зафиксированы milestones и приоритеты MVP | |
| 2026-02-06 12:45 MSK | ChatGPT | doc | Добавлены статусы и backlog IDEA-###, синхронизированы env/infra формулировки | |

# CHATLOG (RU): итоги сессий и память чатов

Актуально на: 2026-02-06 00:40 MSK
Назначение: хранить **инженерные итоги** каждой существенной сессии (не сырой чат).  

Примечание про время: время записей и история фиксируются в **MSK (Europe/Moscow, UTC+3)**.

Правило: если в чате появилось полезное правило/решение/изменение планов, оно должно быть:
- зафиксировано здесь (итоги), и
- отражено в ADR/CHANGELOG/живых документах, если применимо (см. `docs/WORKFLOW_CONTRACT_RU.md`).

## Формат записи
- Дата/время (MSK)
- Цель
- Что сделано (кратко)
- Решения (ADR ссылки)
- Документы обновлены (INDEX/CONTRACT/PRD/TECH/OPS/CHANGELOG)
- Следующие шаги

## Журнал

### 2026-02-04 03:00 MSK
Цель: поднять базовый контур документации и процесса работы “архив + команды”.

Что сделано:
- Введён единый вход `docs/INDEX_RU.md`
- Зафиксирован процесс `docs/WORKFLOW_CONTRACT_RU.md`
- Добавлены/уточнены PRD/TECH/OPS, шаблон ADR, CHANGELOG, PATCH_REPORT

Решения:
- Структура документации разделена по назначению (INDEX/CONTRACT/PRD/TECH/OPS + ADR + CHANGELOG)

Документы обновлены:
- INDEX/CONTRACT/PRD/TECH/OPS/CHANGELOG (+ PATCH_REPORT)

Следующие шаги:
- Уточнить контракт под автономную разработку ассистентом и закрепить правила памяти проекта (CHATLOG/ADR).

### 2026-02-05 03:00 MSK
Цель: перестроить процесс под автономную разработку ассистентом и закрепить память проекта.

Что сделано:
- Переписан `docs/WORKFLOW_CONTRACT_RU.md`: добавлены правила CHATLOG/ADR/CHANGELOG, инкрементальные пакеты, требования к командам (VTE-friendly).
- Обновлён `docs/INDEX_RU.md`: добавлен CHATLOG.
- Приведён ADR template к обязательным полям (MSK/Status/Context/Decision/Consequences).
- Обновлён CI docs-policy: разрешён `docs/CHATLOG_RU.md`.

Решения:
- Память проекта ведётся через: `docs/CHATLOG_RU.md` (итоги), `docs/adr/` (решения), `CHANGELOG.md` (изменения).

Документы обновлены:
- INDEX/CONTRACT/ADR template/CI policy/CHANGELOG

Следующие шаги:
- Переписать содержательно PRD/TECH/OPS по текущему коду (и синхронизировать с реальным состоянием).
## 2026-02-05: CI/infra стабилизация (smoke, .env, deps, trade-controls)

Контекст: несколько подряд красных прогонов GitHub Actions из‑за ошибок в workflow YAML, guard для `.env`, требований CI к наличию `.env`, падения Trivy (CVE), конфликтов зависимостей aiogram/aiohttp и нестабильного smoke‑health (бот падал при фейковом токене).

Что сделано (итоги):
- `deploy.yml`: вычищены ошибки YAML и сделан стабильный pipeline.
- Guard для `.env`: запрещаем трекать `.env` и `.env.*`, **кроме** `.env.example` (он должен оставаться в git).
- `ci-smoke`: перед `docker compose config` создаём `.env` из `.env.example` (CI не держит секреты в репо).
- Trivy: устранён HIGH по `aiohttp` (обновление зависимости). 
- Smoke health: бот больше не умирает при фейковом токене в CI (иначе `get_me` падает с Unauthorized и контейнер рестартится).
- SQLite/локальное хранилище: пути сделаны smoke‑safe (используем `/tmp/...` в CI, чтобы не упираться в права/отсутствующие директории).
- GitHub trade-controls: зафиксировано, что remote может быть временно недоступен; на период ограничений репозиторий был переключён в public как временная мера.

Примечания:
- Старые красные workflow‑раны остаются в истории как “failed” для тех SHA. Это нормально: корректность подтверждает **последний зелёный** прогон. При необходимости старые раны можно “Re-run” вручную (см. docs GitHub Actions).

### 2026-02-06 00:10 MSK
Цель: зафиксировать цельную картину продукта и системы (Telegram ↔ VPS ↔ Яндекс.Диск) и привести документацию к текущей визии.

Что сделано:
- Переписан `docs/WORKFLOW_CONTRACT_RU.md`: закрыта “пустая секция 1”, удалены дубли, закреплены правила “только пакеты”, шаблон применения, коммит‑месседжи только по‑русски, запрет на лишние новые файлы.
- Обновлён `docs/INDEX_RU.md`: убраны ссылки на несуществующий CHANGELOG, добавлены роли документов и ROADMAP.
- Обновлён `docs/DOCS_RATIONALE_RU.md`: оставлено только объяснение структуры, нормативные правила вынесены в WORKFLOW CONTRACT.
- Переписан `docs/PRD_RU.md`: описан продукт (закрытая библиотека), роли, режим доступа без инвайтов, UX ограничения (не светить хранилище).
- Переписан `docs/TECH_SPEC_RU.md`: целевая архитектура, лимиты Telegram (50MB/20MB), Local Bot API Server, inline‑навигация, фоновые синки, кэш file_id, модель данных.
- Переписан `docs/OPS_RUNBOOK_RU.md`: эксплуатация связки, ключевые инциденты (401/429), роль админ‑канала.
- Переписан `docs/ROADMAP_RU.md`: приоритеты по milestones (inline+local API+sync+cache → доступ → ops).

Следующие шаги:
- Реализовать Milestone 1 (Inline Catalog + Local Bot API + фоновые синки + кэш file_id).
- После выбора конкретных решений по Local Bot API (образ/настройки/сети) оформить ADR.

### 2026-02-06 00:40 MSK
Цель: закрепить правило выбора источника для задач (GitHub / архив / внешние факты) и требование объявлять режим в начале работы.

Что сделано:
- В `docs/WORKFLOW_CONTRACT_RU.md` добавлен раздел 4.1: когда нужен GitHub-коннектор, когда нужен архив, и когда требуются внешние источники от пользователя.
- Зафиксировано требование: перед началом любой задачи ассистент пишет “Режим: …” (GitHub / Архив / Внешние источники).

Документы обновлены:
- CONTRACT

Следующие шаги:
- Всегда начинать задачи с явного выбора режима и списком “что требуется” от пользователя.

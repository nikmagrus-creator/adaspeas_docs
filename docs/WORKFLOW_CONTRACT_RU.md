## 0) Source of Truth и окружение (обязательные по умолчанию)
Часовой пояс по умолчанию для планирования и формулировок “сегодня/завтра”: **Europe/Moscow (MSK)**.
Таймстемпы в документах и таблицах “История изменений” фиксируем в **MSK** (UTC+3).

- Source of Truth для документации и правил процесса: https://github.com/nikmagrus-creator/adaspeas_docs
- Ветка по умолчанию: `main`

Каноничные пути (раз и навсегда):
- Local (Linux Mint), репозиторий: `/home/nik/projects/adaspeas`
- Папка скачивания архивов: `/media/nik/0C30B3CF30B3BE50/Загрузки`
- VPS директория проекта: `/opt/adaspeas`

Хранилище (если используется Яндекс.Диск):
- Основная папка каталога: `Zkvpr` (не `Adaspeas`).

## 0.1) Золотое правило деплоя
- VPS обновляется **только** через репозиторий и CI/CD. Ручные изменения на VPS запрещены.
- Любые изменения: локально → `git commit` → `git push` → CI применяет на VPS.

---

## 1) Источник правды, вложения и дисциплина документов

### 1.1) Источник правды (SoT)
- **Единственный Source of Truth** по коду/докам/процессу: репозиторий GitHub (`main`).
- Любое утверждение «как устроено / где лежит / что делать» подтверждаем файлами в `main`.
- Если в чате есть противоречие с репозиторием — **верим репозиторию**, а чат считаем черновиком.

### 1.2) Вложения/архивы из чата
- Любые вложения/архивы из чата — **потенциально устаревшие**.
- Вложения допустимы только когда ассистент **не может** получить это из репозитория (например: внешний закрытый файл, дамп/артефакт, который не должен коммититься).
- При любом сомнении требуется **актуальный** архив/файл или ссылка на конкретный commit, затем сверка по дереву репозитория.

### 1.3) Не плодим документы
Дублирующиеся документы неизбежно начинают противоречить друг другу. Поэтому:
- сначала обновляем существующие документы;
- новые файлы добавляем только при появлении **нового типа артефакта** (INDEX/CONTRACT/ADR/CHANGELOG/CHATLOG) и только когда это действительно необходимо.

---

## 2) Поставка изменений (единственный допустимый формат)

Изменение считается поставленным **только** если оно:
- оформлено как **инкрементальный `tar.gz` пакет** (только изменённые файлы/папки, корректные пути от корня репозитория),
- при наличии удалений содержит `.pack/deleted.txt` со списком путей для удаления,
- применимо воспроизводимо (один короткий безопасный блок команд: применить → удалить при необходимости → `git status` → commit → push).

Примечание: цель формата пакетов — избежать “призрачных файлов”, которые остаются после распаковки архивов, и сохранить историю в git.

---

## 3) Правила сообщений коммитов (только русский)
- Сообщения коммитов пишем **только на русском**.
- Формат: `область: действие + уточнение` (в нижнем регистре, без точки в конце).
Примеры:
- `доки: заполнить секцию 1 (SoT и вложения) в WORKFLOW_CONTRACT`
- `ci: стабилизировать smoke без реальных токенов`
- `воркер: добавить ретраи и коды ошибок`

Правило: один коммит = одна смысловая правка. Смешивать “доки + код + инфраструктуру” без жёсткой необходимости нельзя.

---

## 4) Минимум текста в чате (anti-spam)
Чат используется только для управления работой и фиксации результата, без “простыней”.

Разрешено:
- 3–10 строк: что меняем, какие файлы затронуты, риски/удаления.
- Ссылка на пакет (`tar.gz`) и **один** блок команд применения.

Запрещено:
- Полные файлы, большие диффы, длинные команды с вариациями “на выбор”.
- Дублировать содержимое документов в чат.

---

## 5) Память проекта: итоги чатов и решения
Сырая переписка в чате не является Source of Truth. Всё, что “надо помнить дальше”, фиксируем в репозитории:
- Итоги каждой существенной сессии: `docs/CHATLOG_RU.md` (MSK, кратко, по делу).
- Принятые решения: `docs/adr/` (ADR). Шаблон: `docs/adr/ADR-000-template.md`.

Правило: если в чате появилось полезное правило/решение/изменение планов, оно должно быть отражено в CHATLOG и, если это влияет на архитектуру/процесс, подкреплено ADR.

---

## X) Надёжность remote: trade-controls/санкции/блокировки
Случаи, когда GitHub временно недоступен (DNS/сеть, trade controls, санкции) считаются **нормальным риском**, не “катастрофой”.

Правила:
- коммиты делаем локально как обычно, история не теряется;
- держим **fallback remote** (зеркало) на альтернативном хостинге (например: Codeberg/GitLab/self-hosted Gitea);
- после восстановления GitHub делаем sync обратно: `git push --mirror` или обычные ветки/теги по ситуации;
- временный перевод репозитория в public допустим только как вынужденная мера:
  - секреты/ключи/токены в git запрещены (см. guard по .env);
  - решение фиксируем в `docs/CHATLOG_RU.md` (дата/время MSK, причина, план возврата).

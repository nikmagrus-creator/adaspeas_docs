# PRD (RU): Adaspeas — закрытая библиотека файлов в Telegram

Актуально на: 2026-02-06 00:10 MSK

## 1) Что мы строим и для чего

Adaspeas — это Telegram‑бот для выдачи файлов из внешнего хранилища (Яндекс.Диск) пользователям с ограниченным доступом.

Главная идея: пользователь видит “категории” и “файлы” как библиотеку и скачивает их в 2–3 нажатия. В Telegram нельзя редактировать каталог и нельзя увидеть, что за ним стоит Яндекс.Диск.

Система состоит из связки: Telegram (UI) + VPS (бот/воркеры/БД) + Яндекс.Диск (источник файлов).

## 2) Роли и сценарии

### Пользователь
- видит каталог (категории/папки) и файлы;
- может скачивать файлы;
- не видит внутренние пути/названия внешнего хранилища;
- имеет ограничение по времени доступа (по умолчанию 30 дней) и получает уведомление за 24 часа до истечения.

### Администратор
- управляет доступом пользователей (активация, срок, продление, блокировка);
- получает уведомления об истекающем доступе;
- видит базовую статистику (кто что скачивал, ошибки доставки);
- при необходимости запускает обновление каталога (или оно происходит автоматически по расписанию).

## 3) Модель доступа (выбранный режим)

Режим: **без инвайт‑кодов**.

- Любой пользователь может написать боту.
- До одобрения админом пользователь находится в статусе “ожидает” и не видит каталог.
- После одобрения: доступ активен **30 дней** (по умолчанию).
- За 24 часа до истечения бот уведомляет пользователя и админа.
- Пользователь не имеет кнопки “автопродление” и не должен “спамить админа” запросами.

## 4) UX требования

- Навигация по каталогу интерактивная (inline‑клавиатуры) и работает через редактирование одного сообщения.
- Каталог строится строго по структуре на диске: корневая папка → подпапки → файлы.
- В Telegram нельзя создавать/переименовывать/удалять папки и файлы.
- В боте не должно быть видно слова “Яндекс”, “Диск”, внутренних путей, ID ресурсов.

## 5) Функциональные требования

Каталог:
- отображение списка папок и файлов текущей “категории”;
- кнопка “Назад”;
- опционально: кнопка “Обновить каталог” (для админа) и отображение времени последней синхронизации.

Скачивание:
- пользователь выбирает файл кнопкой → бот ставит задачу на скачивание/отправку;
- повторные скачивания должны быть быстрыми (кэширование Telegram `file_id`).

Доступ:
- админ видит список пользователей (поиском/страницами);
- админ меняет статус и срок;
- уведомления об истечении срока: пользователю и админу.

Аудит/статистика (минимум):
- лог скачиваний: кто, что, когда, успешно/ошибка;
- агрегированная статистика для админа (топ скачиваний, активные пользователи) — без фанатизма.

## 6) Ограничения и важные нюансы

- Telegram Bot API без локального сервера ограничивает загрузку файлов ботом 50 MB и скачивание файлов ботом 20 MB.
- Проект “библиотеки” почти гарантированно упрётся в лимит, поэтому архитектура должна учитывать режим Local Bot API Server (см. TECH_SPEC/OPS).

## 7) Что НЕ делаем

- не делаем “файловый менеджер” в Telegram;
- не делаем сложную модерацию контента;
- не делаем публичный каталог;
- не делаем автопродление доступа по кнопке пользователя;
- не светим устройство хранилища и не даём прямые ссылки на внешний диск.

## 8) Критерии готовности (Definition of Done)

Фича считается готовой, когда:
- пользователь с активным доступом может пройти каталог папок и скачать файл через кнопки;
- файл > 50 MB тоже доставляется (через Local Bot API Server);
- пользователь без доступа не видит каталог;
- админ может выдать/продлить/отозвать доступ;
- есть минимальный аудит скачиваний и уведомления об истечении.

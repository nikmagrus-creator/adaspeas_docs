# PRD: Adaspeas (консолидировано)

Актуально на: 2026-02-04 12:00 UTC

Этот файл описывает “что делаем и зачем”. Технические детали и эксплуатация вынесены в TECH/OPS.

## 1) Вижн и цель
Adaspeas — бот с фоновой обработкой задач: бот принимает запрос, создаёт job, воркер выполняет job, пользователь получает статус/результат.

Цель MVP:
- минимальная полезная функциональность без лишней инфраструктуры
- предсказуемая эксплуатация (автодеплой, health/metrics, быстрый перенос на новый VPS)

Не цель MVP:
- постоянное хранение файлов на VPS
- тяжёлая админка

## 2) Пользователи и роли
- Пользователь: инициирует действия через бота, получает ответы/статусы.
- Администратор: расширенные права (через `ADMIN_USER_IDS`).
- Worker: выполняет асинхронные задания.

## 3) Основные потоки (MVP)
- Пользователь → запрос в бота.
- Бот валидирует запрос, создаёт job (персистентно).
- Бот кладёт job_id в очередь (Redis).
- Worker забирает job_id, выполняет, пишет статус/результат в SQLite.
- Пользователь получает итог/статус.

## 4) Данные и жизненный цикл
- SQLite — Source of Truth (users/roles/catalog/jobs).
- Redis — транспорт очереди (job_id), не источник истины.
- Потеря Redis не должна приводить к необратимой потере состояния.

## 5) Ограничения и допущения
- Worker идемпотентен.
- Retry ≤ 3.
- Метрики доступны, но в проде защищены Basic Auth.
- Секреты не хранятся в репозитории.

## 6) Definition of Done (MVP)
Считаем MVP “готовым”, когда:
- `/health` стабильно отдаёт 200 `{"ok": true}` (локально и в проде).
- `/metrics` доступен локально; в проде закрыт Basic Auth.
- Job выполняются воркером и фиксируют состояние в SQLite.
- Есть автодеплой в main и описанный rollback.
- Есть процедура миграции/переноса на новый VPS.

## История изменений
| Дата/время (UTC) | Автор | Тип | Кратко | Commit/PR |
|---|---|---|---|---|
| 2026-02-04 12:00 UTC | ChatGPT | doc | Добавлены DoD и ссылки на системные документы (INDEX/CONTRACT) | |

# PRD: Adaspeas (v6, консолидировано)

Актуально на: 2026-02-04 00:00 UTC

Этот файл заменяет собой разрозненные продуктовые заметки/handbook. Цель — один источник правды по “что делаем и зачем”.

## 1) Вижн и цель
Adaspeas — бот с фоновой обработкой задач: бот принимает запрос, создаёт job, воркер выполняет job, пользователь получает статус/результат.

Цель MVP:
- минимальная полезная функциональность без “зоопарка” инфраструктуры
- предсказуемая эксплуатация (автодеплой, health/metrics, быстрый перенос на новый VPS)

Не цель MVP:
- постоянное хранение файлов на VPS
- тяжёлая админка

## 2) Пользователи и роли
- Пользователь: инициирует действия через бота, получает ответы/статусы.
- Администратор: расширенные права и доступ к диагностике (через `ADMIN_USER_IDS`).
- Система (worker): выполняет асинхронные задания.

## 3) Основные пользовательские потоки (MVP)
- Пользователь отправляет команду/запрос в бот.
- Бот валидирует запрос и создаёт job (персистентно).
- Бот кладёт job_id в очередь (Redis).
- Worker забирает job_id, выполняет задачу, пишет статус/результат в SQLite.
- Пользователь получает итог/статус.

## 4) Данные и жизненный цикл
- Персистентные сущности (пользователи/роли/каталог/джобы) — в SQLite (Source of Truth).
- Очередь — Redis (транспорт). Потеря Redis не должна “убивать” систему навсегда.
- Результат/состояние job должно быть восстанавливаемым из SQLite.

## 5) Ограничения и допущения
- Воркер идемпотентен: повтор job не ломает данные.
- Retry до 3 попыток.
- Метрики доступны, но в проде защищены Basic Auth.
- Секреты не хранятся в репозитории.

## 6) Нефункциональные требования
- Надёжность: деградация допустима, “кирпич” недопустим.
- Эксплуатация: одна команда (push в main) должна приводить к выкату.
- Наблюдаемость: минимум `/health` + `/metrics`.

## История изменений
| Дата/время (UTC) | Автор | Тип | Кратко что изменили | Причина/ссылка | Commit/PR |
|---|---|---|---|---|---|
| 2026-02-04 00:00 UTC | ChatGPT | doc | Консолидация продуктовых документов в один PRD_RU.md | сокращение документации | |

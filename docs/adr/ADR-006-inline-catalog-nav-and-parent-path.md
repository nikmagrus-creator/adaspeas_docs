# ADR-006: Inline‑навигация каталога и parent_path в SQLite

Актуально на: 2026-02-07 18:30 MSK

- Status: Accepted
- Date (MSK): 2026-02-07 18:30 MSK
- Deciders: Nikolay, ChatGPT
- Technical Story: Milestone 1 — UX каталога

## Context
Нужно сделать навигацию по каталогу (папки/файлы) через inline‑кнопки Telegram.

Ограничения и требования:
1) `callback_data` у `InlineKeyboardButton` ограничена по размеру (до 64 байт), поэтому передавать в ней путь к файлу/папке напрямую небезопасно.
2) Навигация должна редактировать одно сообщение (не засорять чат).
3) Нужна кнопка “Назад”, но не хочется поддерживать стек состояний в FSM ради простого дерева.
4) Каталог хранится в SQLite и используется как кэш.

## Decision
1) В inline‑кнопках передавать только короткие идентификаторы элементов каталога: `nav:<id>:<offset>` и `dl:<id>`, где `<id>` это числовой `id` строки в таблице `catalog_items`.
2) В SQLite добавить поле `parent_path` (миграция схемы v3), чтобы:
   - быстро получать детей папки по `parent_path=<path>`;
   - уметь строить кнопку “Назад” без FSM‑стека.
3) UI каталога в боте читает **только SQLite** (детей папки по `parent_path`).
   Синхронизацию с внешним хранилищем выполняет отдельный worker по команде /sync (и/или по расписанию).

Что нужно сделать дальше:
- Добавить фоновые job’ы синхронизации и метку `last_catalog_sync_at` (таблица meta), чтобы UI мог работать исключительно по SQLite.

## Links
- Chatlog: docs/CHATLOG_RU.md (запись 2026-02-07 18:30 MSK)
- Related ADRs: ADR-005 (main‑only + repo hygiene)
